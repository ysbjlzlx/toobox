import{C as P,D as k,E as A,r as g,G as H,l as M,w as U}from"./pro-components-D4VvMrwW.js";import{r as E,E as z,R as B,S as $,aN as j,B as w,at as F}from"./antd-DeG7bo76.js";import{I}from"./index-CnZGZKCS.js";import{u as K}from"./index-BFGRXhnt.js";import{T as W,U as q,X as G,Y as X}from"./jsoneditor-B3PGnrMj.js";import{L as Y,U as Z,g as Q,i as V,b as ee,c as te,d as re,p as ne,e as oe,a as se,s as ae,t as ie,f as ce}from"./stringify-zIPPAhny.js";function ue(e){throw new Error("config is deprecated, support for circularRefs is removed from the library. If you encounter circular references in your data structures, please rethink your datastructures: better prevent circular references in the first place.")}function le(e,t){return typeof t=="string"&&de.test(t)?new Date(t):t}const de=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/,fe=Object.freeze(Object.defineProperty({__proto__:null,LosslessNumber:Y,UnsafeNumberReason:Z,config:ue,getUnsafeNumberReason:Q,isInteger:V,isLosslessNumber:ee,isNumber:te,isSafeNumber:re,parse:ne,parseLosslessNumber:oe,parseNumberAndBigInt:se,reviveDate:le,stringify:ae,toLosslessNumber:ie,toSafeNumberOrThrow:ce},Symbol.toStringTag,{value:"Module"})),me={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},R=e=>{let t;const n=new Set,o=(S,y)=>{const p=typeof S=="function"?S(t):S;if(!Object.is(p,t)){const m=t;t=y??(typeof p!="object"||p===null)?p:Object.assign({},t,p),n.forEach(u=>u(t,m))}},a=()=>t,f={setState:o,getState:a,getInitialState:()=>l,subscribe:S=>(n.add(S),()=>n.delete(S)),destroy:()=>{(me?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},l=t=e(o,a,f);return f},ve=e=>e?R(e):R;var D={exports:{}},T={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _=E,he=P;function Se(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var pe=typeof Object.is=="function"?Object.is:Se,ge=he.useSyncExternalStore,ye=_.useRef,be=_.useEffect,Ee=_.useMemo,xe=_.useDebugValue;T.useSyncExternalStoreWithSelector=function(e,t,n,o,a){var r=ye(null);if(r.current===null){var d={hasValue:!1,value:null};r.current=d}else d=r.current;r=Ee(function(){function f(m){if(!l){if(l=!0,S=m,m=o(m),a!==void 0&&d.hasValue){var u=d.value;if(a(u,m))return y=u}return y=m}if(u=y,pe(S,m))return u;var s=o(m);return a!==void 0&&a(u,s)?u:(S=m,y=s)}var l=!1,S,y,p=n===void 0?null:n;return[function(){return f(t())},p===null?void 0:function(){return f(p())}]},[t,n,o,a]);var v=ge(e,r[0],r[1]);return be(function(){d.hasValue=!0,d.value=v},[v]),xe(v),v};D.exports=T;var _e=D.exports;const je=z(_e),O={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},{useDebugValue:we}=B,{useSyncExternalStoreWithSelector:Ie}=je;let N=!1;const Re=e=>e;function Ne(e,t=Re,n){(O?"production":void 0)!=="production"&&n&&!N&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),N=!0);const o=Ie(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return we(o),o}const De=e=>{(O?"production":void 0)!=="production"&&typeof e!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof e=="function"?ve(e):e,n=(o,a)=>Ne(t,o,a);return Object.assign(n,t),n},Te=e=>De,Oe={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function C(e,t){let n;try{n=e()}catch{return}return{getItem:a=>{var r;const d=f=>f===null?null:JSON.parse(f,void 0),v=(r=n.getItem(a))!=null?r:null;return v instanceof Promise?v.then(d):d(v)},setItem:(a,r)=>n.setItem(a,JSON.stringify(r,void 0)),removeItem:a=>n.removeItem(a)}}const x=e=>t=>{try{const n=e(t);return n instanceof Promise?n:{then(o){return x(o)(n)},catch(o){return this}}}catch(n){return{then(o){return this},catch(o){return x(o)(n)}}}},Ce=(e,t)=>(n,o,a)=>{let r={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:c=>c,version:0,merge:(c,h)=>({...h,...c}),...t},d=!1;const v=new Set,f=new Set;let l;try{l=r.getStorage()}catch{}if(!l)return e((...c)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),n(...c)},o,a);const S=x(r.serialize),y=()=>{const c=r.partialize({...o()});let h;const i=S({state:c,version:r.version}).then(b=>l.setItem(r.name,b)).catch(b=>{h=b});if(h)throw h;return i},p=a.setState;a.setState=(c,h)=>{p(c,h),y()};const m=e((...c)=>{n(...c),y()},o,a);let u;const s=()=>{var c;if(!l)return;d=!1,v.forEach(i=>i(o()));const h=((c=r.onRehydrateStorage)==null?void 0:c.call(r,o()))||void 0;return x(l.getItem.bind(l))(r.name).then(i=>{if(i)return r.deserialize(i)}).then(i=>{if(i)if(typeof i.version=="number"&&i.version!==r.version){if(r.migrate)return r.migrate(i.state,i.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return i.state}).then(i=>{var b;return u=r.merge(i,(b=o())!=null?b:m),n(u,!0),y()}).then(()=>{h==null||h(u,void 0),d=!0,f.forEach(i=>i(u))}).catch(i=>{h==null||h(void 0,i)})};return a.persist={setOptions:c=>{r={...r,...c},c.getStorage&&(l=c.getStorage())},clearStorage:()=>{l==null||l.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>s(),hasHydrated:()=>d,onHydrate:c=>(v.add(c),()=>{v.delete(c)}),onFinishHydration:c=>(f.add(c),()=>{f.delete(c)})},s(),u||m},Je=(e,t)=>(n,o,a)=>{let r={storage:C(()=>localStorage),partialize:s=>s,version:0,merge:(s,c)=>({...c,...s}),...t},d=!1;const v=new Set,f=new Set;let l=r.storage;if(!l)return e((...s)=>{console.warn(`[zustand persist middleware] Unable to update item '${r.name}', the given storage is currently unavailable.`),n(...s)},o,a);const S=()=>{const s=r.partialize({...o()});return l.setItem(r.name,{state:s,version:r.version})},y=a.setState;a.setState=(s,c)=>{y(s,c),S()};const p=e((...s)=>{n(...s),S()},o,a);a.getInitialState=()=>p;let m;const u=()=>{var s,c;if(!l)return;d=!1,v.forEach(i=>{var b;return i((b=o())!=null?b:p)});const h=((c=r.onRehydrateStorage)==null?void 0:c.call(r,(s=o())!=null?s:p))||void 0;return x(l.getItem.bind(l))(r.name).then(i=>{if(i)if(typeof i.version=="number"&&i.version!==r.version){if(r.migrate)return[!0,r.migrate(i.state,i.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,i.state];return[!1,void 0]}).then(i=>{var b;const[J,L]=i;if(m=r.merge(L,(b=o())!=null?b:p),n(m,!0),J)return S()}).then(()=>{h==null||h(m,void 0),m=o(),d=!0,f.forEach(i=>i(m))}).catch(i=>{h==null||h(void 0,i)})};return a.persist={setOptions:s=>{r={...r,...s},s.storage&&(l=s.storage)},clearStorage:()=>{l==null||l.removeItem(r.name)},getOptions:()=>r,rehydrate:()=>u(),hasHydrated:()=>d,onHydrate:s=>(v.add(s),()=>{v.delete(s)}),onFinishHydration:s=>(f.add(s),()=>{f.delete(s)})},r.skipHydration||u(),m||p},Le=(e,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?((Oe?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),Ce(e,t)):Je(e,t),Pe=Le,ke=Te()(Pe((e,t)=>({jsonTabs:["0"],activeKey:"0",addJsonTab:n=>e(()=>({jsonTabs:k(t().jsonTabs,n)})),removeJsonTab:n=>e(()=>({jsonTabs:A(t().jsonTabs,n)})),setActiveKey:n=>e(()=>({activeKey:n}))}),{name:"json-tab-store",storage:C(()=>localStorage)})),Ae=e=>{const t=E.useRef(null),n=E.useRef();return E.useEffect(()=>(t!=null&&t.current&&(n.current=new W({target:t.current,props:{parser:fe,queryLanguages:[q,G]}})),()=>{n.current&&(n.current.destroy(),n.current=void 0)}),[]),E.useEffect(()=>{var o;n.current&&((o=n.current)==null||o.updateProps({...e}))},[e]),g.jsx("div",{className:"h-full w-full",ref:t})},He=e=>{const t={mode:"text",content:{text:""}},n=(e==null?void 0:e.idx)||"0",[o,a]=K(`json-${n}`,{defaultValue:t}),r=()=>o==null?X.text:o.mode,d=f=>{a(l=>({...l,content:f}))},v=f=>{a(l=>({...l,mode:f}))};return g.jsx(Ae,{mode:r(),content:o.content,onChange:d,onChangeMode:v})},Ke=()=>{const{jsonTabs:e,activeKey:t,addJsonTab:n,removeJsonTab:o,setActiveKey:a}=ke(),[r,d]=E.useState([]);E.useEffect(()=>{const u=e.map(s=>({key:s,label:`Tab ${s}`,closable:!0,children:g.jsx(He,{idx:s}),className:"h-[calc(100dvh-112px)] md:h-[calc(100dvh-56px)]"}));if(H(e,t)===-1){const s=M(u);a((s==null?void 0:s.key)||"0")}d(u)},[e,t,a]);const v=u=>{a(u)},f=(u,s)=>{s==="add"?l():S(u)},l=()=>{let u="0";if(e&&e.length>0){const s=e.map(h=>Number(h));u=`${Math.max(...s)+1}`}n(u),a(u)},S=u=>{o(String(u)),localStorage.removeItem(`json-${u}`),e&&e.length<=1&&n("0")},y={items:[{key:1,label:g.jsx("div",{children:"上传 JSON 文件"})},{key:2,label:g.jsx("div",{children:"上传 Excel 文件"})}]},p={items:[{key:1,label:g.jsx("div",{children:"下载为 JSON 文件"})},{key:2,label:g.jsx("div",{children:"下载为 Excel 文件"})}]},m={left:g.jsx("div",{className:"mx-4 hidden",children:g.jsxs($.Compact,{children:[g.jsx(j,{menu:y,children:g.jsx(w,{icon:g.jsx(I,{icon:"lucide:upload"}),children:"上传"})}),g.jsx(j,{menu:p,children:g.jsx(w,{icon:g.jsx(I,{icon:"lucide:download"}),children:"下载"})})]})})};return g.jsx(U,{title:!1,className:"w-full",children:g.jsx(F,{type:"editable-card",size:"small",onChange:v,activeKey:t,onEdit:f,items:r,tabBarExtraContent:m})})};export{Ke as Component};
