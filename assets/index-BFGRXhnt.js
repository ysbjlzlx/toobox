import{_ as I}from"./index-CnZGZKCS.js";import{r as c}from"./antd-DeG7bo76.js";var M=function(r){return function(a,e){var n=c.useRef(!1);r(function(){return function(){n.current=!1}},[]),r(function(){if(!n.current)n.current=!0;else return a()},e)}},R=function(r){return typeof r=="function"},B=function(r){return typeof r=="number"},U=function(r){return typeof r>"u"};function V(r){var a=c.useRef(r);a.current=c.useMemo(function(){return r},[r]);var e=c.useRef();return e.current||(e.current=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return a.current.apply(this,n)}),e.current}const F=M(c.useEffect);function A(r,a){if(r===a)return!0;for(var e=0;e<r.length;e++)if(!Object.is(r[e],a[e]))return!1;return!0}function z(r){var a=c.useRef(r);return a.current=r,a}var W=function(r){var a=z(r);c.useEffect(function(){return function(){a.current()}},[])},L=!!(typeof window<"u"&&window.document&&window.document.createElement);function T(r,a){if(L){if(!r)return a;var e;return R(r)?e=r():"current"in r?e=r.current:e=r,e}}var x=function(r){var a=function(e,n,t){var s=c.useRef(!1),f=c.useRef([]),v=c.useRef([]),i=c.useRef();r(function(){var o,g=Array.isArray(t)?t:[t],l=g.map(function(E){return T(E)});if(!s.current){s.current=!0,f.current=l,v.current=n,i.current=e();return}(l.length!==f.current.length||!A(f.current,l)||!A(v.current,n))&&((o=i.current)===null||o===void 0||o.call(i),f.current=l,v.current=n,i.current=e())}),W(function(){var o;(o=i.current)===null||o===void 0||o.call(i),s.current=!1})};return a},G=x(c.useEffect);function y(r,a,e){e===void 0&&(e={});var n=e.enable,t=n===void 0?!0:n,s=z(a);G(function(){if(t){var f=T(e.target,window);if(f!=null&&f.addEventListener){var v=function(i){return s.current(i)};return f.addEventListener(r,v,{capture:e.capture,once:e.once,passive:e.passive}),function(){f.removeEventListener(r,v,{capture:e.capture})}}}},[r,e.capture,e.once,e.passive,t],e.target)}var b="AHOOKS_SYNC_STORAGE_EVENT_NAME";function J(r){function a(e,n){n===void 0&&(n={});var t,s=n.listenStorageChange,f=s===void 0?!1:s,v=n.onError,i=v===void 0?function(u){console.error(u)}:v;try{t=r()}catch(u){i(u)}var o=function(u){return n.serializer?n.serializer(u):JSON.stringify(u)},g=function(u){return n.deserializer?n.deserializer(u):JSON.parse(u)};function l(){try{var u=t==null?void 0:t.getItem(e);if(u)return g(u)}catch(d){i(d)}return R(n.defaultValue)?n.defaultValue():n.defaultValue}var E=I(c.useState(l),2),h=E[0],S=E[1];F(function(){S(l())},[e]);var w=function(u){var d=R(u)?u(h):u;f||S(d);try{var m=void 0,O=t==null?void 0:t.getItem(e);U(d)?(m=null,t==null||t.removeItem(e)):(m=o(d),t==null||t.setItem(e,m)),dispatchEvent(new CustomEvent(b,{detail:{key:e,newValue:m,oldValue:O,storageArea:t}}))}catch(C){i(C)}},_=function(u){u.key!==e||u.storageArea!==t||S(l())},N=function(u){_(u.detail)};return y("storage",_,{enable:f}),y(b,N,{enable:f}),[h,V(w)]}return a}var H=J(function(){return L?localStorage:void 0});export{z as a,B as i,H as u};
