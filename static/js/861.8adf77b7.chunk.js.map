{"version":3,"file":"static/js/861.8adf77b7.chunk.js","mappings":"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","sources":["components/ContentCopyAdornment.tsx","pages/totp/AccountList.tsx","pages/totp/TokenField.tsx","pages/totp/TotpCard.tsx","pages/totp/DetailInfo.tsx","pages/totp/index.tsx"],"sourcesContent":["import { ContentCopy } from '@mui/icons-material';\nimport { IconButton, InputAdornment, Snackbar } from '@mui/material';\nimport ClipboardJS from 'clipboard';\nimport { useEffect, useRef, useState } from 'react';\n\ninterface Props {\n  content?: string | undefined;\n  onSuccess?: Function | undefined;\n}\n\nexport default function ContentCopyAdornment({ content, onSuccess }: Props) {\n  const btn = useRef<HTMLButtonElement>(null);\n  const [open, setOpen] = useState<boolean>(false);\n\n  useEffect(() => {\n    if (btn.current) {\n      const clipboard = new ClipboardJS(btn.current);\n      clipboard.on('success', (e) => {\n        setOpen(true);\n      });\n      clipboard.on('error', (e) => {\n        console.error(e);\n      });\n    }\n  }, []);\n\n  return (\n    <>\n      <InputAdornment position=\"end\">\n        <IconButton ref={btn} data-clipboard-text={content} aria-label=\"Copy content\">\n          <ContentCopy />\n        </IconButton>\n      </InputAdornment>\n\n      <Snackbar open={open} onClose={() => setOpen(false)} autoHideDuration={3000} message=\"复制成功\" />\n    </>\n  );\n}\n","import { Box, List, ListItem, ListItemText } from '@mui/material';\nimport { TotpI } from './typings';\n\ninterface Props {\n  totps?: TotpI[];\n}\n\nconst AccountList = ({ totps }: Props) => {\n  return (\n    <Box>\n      <List>\n        {totps?.map((totp) => {\n          return (\n            <ListItem key={totp.secretKey}>\n              <ListItemText>ha</ListItemText>\n            </ListItem>\n          );\n        })}\n      </List>\n    </Box>\n  );\n};\n\nexport default AccountList;\n","import { Box, CircularProgress, TextField, Typography } from '@mui/material';\nimport { useCountDown } from 'ahooks';\nimport dayjs from 'dayjs';\nimport { TOTP } from 'otpauth';\nimport { useEffect, useState } from 'react';\nimport ContentCopyAdornment from '../../components/ContentCopyAdornment';\n\ninterface Props {\n  totp?: TOTP;\n}\n\nconst TokenField = ({ totp }: Props) => {\n  const [targetDate, setTargetDate] = useState<number>(0);\n  const [token, setToken] = useState<string>('');\n\n  useEffect(() => {\n    setTargetDate(0);\n    if (totp) {\n      const second = dayjs().second();\n      const millisecond = dayjs().valueOf();\n      const duration = (second >= 30 ? 60 - second : 30 - second) * 1000;\n      setTargetDate(millisecond + duration);\n      setToken(totp.generate());\n    }\n  }, [totp]);\n\n  const [countTime] = useCountDown({\n    targetDate,\n    onEnd: () => {\n      setTargetDate(0);\n      if (totp) {\n        const second = dayjs().second();\n        const millisecond = dayjs().valueOf();\n        const duration = (second >= 30 ? 60 - second : 30 - second) * 1000;\n        setTargetDate(millisecond + duration);\n        setToken(totp.generate());\n      }\n    },\n  });\n\n  return (\n    <TextField\n      label=\"Token\"\n      value={token}\n      InputProps={{\n        endAdornment: (\n          <>\n            <Box sx={{ position: 'relative', display: 'inline-flex' }}>\n              <CircularProgress variant=\"determinate\" value={((30 - Math.round(countTime / 1000)) / 30) * 100} />\n              <Box\n                sx={{\n                  top: 0,\n                  left: 0,\n                  bottom: 0,\n                  right: 0,\n                  position: 'absolute',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                }}\n              >\n                <Typography variant=\"caption\" component=\"div\" color=\"text.secondary\">\n                  {Math.round(countTime / 1000)}\n                </Typography>\n              </Box>\n            </Box>\n            <ContentCopyAdornment content={token} />\n          </>\n        ),\n      }}\n    />\n  );\n};\nexport default TokenField;\n","import { Box, TextField } from '@mui/material';\nimport { TOTP } from 'otpauth';\nimport QRCode from 'qrcode';\nimport { useEffect, useMemo, useRef } from 'react';\n\nimport ContentCopyAdornment from '../../components/ContentCopyAdornment';\nimport TokenField from './TokenField';\n\ninterface Props {\n  totp?: TOTP;\n}\n\nconst TotpCard = ({ totp }: Props) => {\n  const qrcodeContainer = useRef<HTMLCanvasElement>(null);\n  const options = useMemo(() => {\n    return { width: 128, height: 128 };\n  }, []);\n\n  useEffect(() => {\n    if (totp) {\n      QRCode.toCanvas(qrcodeContainer.current, totp.toString(), options);\n    }\n  }, [options, totp]);\n  return (\n    <Box>\n      <Box sx={options}>\n        <canvas ref={qrcodeContainer} />\n      </Box>\n      <Box sx={{ mt: 2 }}>\n        <TokenField totp={totp} />\n      </Box>\n\n      <Box sx={{ mt: 2 }}>\n        <TextField\n          label=\"URI\"\n          value={totp?.toString() || ''}\n          InputProps={{ endAdornment: <ContentCopyAdornment content={totp?.toString()} /> }}\n          fullWidth\n        />\n      </Box>\n    </Box>\n  );\n};\nexport default TotpCard;\n","import { Refresh as RefreshIcon } from '@mui/icons-material';\nimport { Box, Button, IconButton, InputAdornment, TextField } from '@mui/material';\nimport * as OTPAuth from 'otpauth';\nimport { Controller, useForm } from 'react-hook-form';\n\nimport { useState } from 'react';\nimport TotpCard from './TotpCard';\nimport { TotpI } from './typings';\n\nconst DetailInfo = () => {\n  const [instance, setInstance] = useState<OTPAuth.TOTP>();\n  const { register, handleSubmit, setValue, control } = useForm<TotpI>({ defaultValues: { secretKey: '' } });\n\n  const refreshSecret = () => {\n    const secret = new OTPAuth.Secret();\n    setValue('secretKey', secret.base32, { shouldDirty: true, shouldTouch: true, shouldValidate: true });\n  };\n  const onSave = (data: TotpI) => {\n    const instance = new OTPAuth.TOTP({\n      issuer: data.issuer,\n      label: data.account,\n      secret: data.secretKey,\n    });\n    setInstance(instance);\n  };\n\n  return (\n    <>\n      <form onSubmit={handleSubmit(onSave)}>\n        <TextField label=\"Issuer\" {...register('issuer')} fullWidth required />\n        <Box sx={{ pt: 2 }}>\n          <TextField label=\"Account\" {...register('account')} fullWidth />\n        </Box>\n        <Box sx={{ pt: 2 }}>\n          <Controller\n            control={control}\n            name=\"secretKey\"\n            render={({ field }) => (\n              <TextField\n                label=\"Secret Key\"\n                {...field}\n                InputProps={{\n                  endAdornment: (\n                    <InputAdornment position=\"end\">\n                      <IconButton onClick={refreshSecret}>\n                        <RefreshIcon />\n                      </IconButton>\n                    </InputAdornment>\n                  ),\n                }}\n                fullWidth\n                required\n              />\n            )}\n          />\n        </Box>\n        <Box sx={{ pt: 2, float: 'right' }}>\n          <Button>取消</Button>\n          <Button type=\"submit\">保存</Button>\n        </Box>\n      </form>\n      <TotpCard totp={instance} />\n    </>\n  );\n};\n\nexport default DetailInfo;\n","import { Container } from '@mui/material';\nimport Grid from '@mui/material/Unstable_Grid2';\nimport { useLocalStorageState } from 'ahooks';\n\nimport * as OTPAuth from 'otpauth';\nimport AccountList from './AccountList';\nimport DetailInfo from './DetailInfo';\nimport { TotpI } from './typings';\n\nconst style = {\n  position: 'absolute' as 'absolute',\n  top: '50%',\n  left: '50%',\n  transform: 'translate(-50%, -50%)',\n  width: 400,\n  bgcolor: 'background.paper',\n  p: 4,\n\n  maxWidth: '700px',\n  boxShadow: 'rgb(97 97 97 / 20%) 0px 4px 20px',\n  borderRadius: 'clamp(0px, (100vw - 750px) * 9999, 10px)',\n};\n\nconst Totp = () => {\n  const [totps, setTotps] = useLocalStorageState<TotpI[]>('totps', { defaultValue: [] });\n\n  console.log(OTPAuth.Secret.fromUTF8('ha'));\n  return (\n    <Container>\n      <Grid container spacing={2} sx={{ mt: 2 }}>\n        <Grid xs={4}>\n          <AccountList totps={totps} />\n        </Grid>\n        <Grid xs={8}>\n          <DetailInfo />\n        </Grid>\n      </Grid>\n    </Container>\n  );\n};\nexport default Totp;\n"],"names":["ContentCopyAdornment","content","btn","onSuccess","useRef","useState","open","setOpen","useEffect","current","clipboard","ClipboardJS","on","e","console","error","position","ref","onClose","autoHideDuration","message","totps","Box","List","map","totp","ListItem","ListItemText","secretKey","targetDate","setTargetDate","token","setToken","second","dayjs","millisecond","valueOf","generate","useCountDown","onEnd","countTime","TextField","label","value","InputProps","endAdornment","sx","display","CircularProgress","variant","Math","round","top","left","bottom","right","alignItems","justifyContent","Typography","component","color","qrcodeContainer","options","useMemo","width","height","QRCode","toString","mt","fullWidth","instance","setInstance","useForm","defaultValues","register","handleSubmit","setValue","control","refreshSecret","secret","OTPAuth","base32","shouldDirty","shouldTouch","shouldValidate","onSubmit","data","issuer","account","required","pt","name","render","field","InputAdornment","IconButton","onClick","Refresh","float","Button","type","useLocalStorageState","defaultValue","log","Container","container","spacing","xs"],"sourceRoot":""}